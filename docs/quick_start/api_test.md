MeterSphere 接口测试模块提供了接口定义、接口自动化等接口测试相关功能。
用户可以在该模块中按照树状的功能模块来组织管理项目下的接口列表，同时针对已添加的接口创建单接口用例，使用多个接口配合变量提取、条件判断等功能进行场景化的接口测试。
![!接口测试首页](../../img/api/接口测试首页.png)

## 维护接口定义

进入 `接口测试->接口定义` 页面。
![!接口定义](../img/api/接口定义.png)

### 导入 Swagger 接口文档

点击左侧下拉菜单中的 `导入` 按钮；
![!导入swagger文件](../img/api/导入swagger文件1.png)

选择 Swagger 数据格式，选择MeterSphere模块，选择使用URL导入，并填入 Swagger 对应的JSON地址 `http://xxx.fit2cloud.com/swagger-ui/index.html`，导入 API 接口。

![!导入swagger文件](../img/api/导入swagger文件2.png)

### 查看接口定义

导入 Swagger 文件之后，在接口列表中找到登录接口 `login_1` ，点击操作列中的 `编辑` 按钮，查看接口详情。
![!编辑接口详情](../img/api/编辑接口详情1.png)

![!编辑接口详情](../img/api/编辑接口详情2.png)


### 为项目添加测试环境

接口列表中仅记录了接口的相对 URL，当我们需要对某个接口进行测试时，需要先在该项目中添加针对该项目的测试环境信息。

进入 `系统设置->项目管理` 页面。点击 MeterSphere 项目操作列中的 `环境配置` 按钮，完善环境名称及环境域名，点击确定保存测试环境信息。
![!项目管理](../img/system_management/环境管理.png)

![!添加环境](../img/system_management/添加环境2.png)

### 调试单个接口

在接口列表中找到 `login_1` 接口，点击操作列中的 `编辑` 按钮，进入接口详情页面。

点击页面右上角的 `测试` 按钮，进入接口测试页面。在接口测试页面选择接口执行环境，并填写接口所需的参数后，点击 `测试` 按钮发送该接口请求。

![!调试单个接口](../img/api/调试单个接口2.png)

当接口请求完成后，可以在下方的响应内容中查看到本次接口请求的响应信息。
![!调试单个接口](../img/api/调试单个接口3.png)

## 创建单接口用例

进入 `接口测试->接口定义` 页面。
![!接口定义](../img/api/接口定义.png)

### 新建单接口用例

在接口列表中找到 `login_1` 接口，点击操作列中的 `CASE` 按钮，弹出该接口下的用例列表页面。

输入接口用例的名称及请求接口所需的其他参数后，点击右下角的 `保存` 按钮保存该接口用例。
![!新建单接口用例](../img/api/新建单接口用例1.png)

![!新建单接口用例](../img/api/新建单接口用例2.png)

### 测试单接口用例

在单接口用例列表中选择执行环境，点击单接口用例列表中的 `执行` 按钮，执行结束后，展开用例详情查看响应内容。
![!测试单接口用例](../img/api/测试单接口用例1.png)

![!测试单接口用例](../img/api/测试单接口用例2.png)

## 创建场景用例

进入 `接口测试->接口自动化` 页面。
![!接口自动化](../img/api/接口自动化.png)

### 新建场景用例

在场景用例列表页面，点击左侧的模块树新建 `MeterSphere` 模块。
点击创建场景按钮新建一个 `查询已出售的第一个宠物` 的场景，填写场景其他信息后，点击 `保存` 按钮保存该场景。
![!新建场景用例](../img/api/新建场景用例1.png)

![!新建场景用例](../img/api/新建场景用例2.png)

![!新建场景用例](../img/api/新建场景用例3.png)


### 在场景用例中添加步骤

点击场景详情中右下角的添加场景步骤按钮，在场景中一次添加如下几个步骤。

![!在场景用例中添加步骤](../img/api/在场景用例中添加步骤1.png)

1. 选择 `接口列表导入` 步骤，在弹出的接口列表中找到 `login_1` 接口进行添加。修改该接口请求中的 `login_1` 中的登录相关参数。
  
    ![!在场景用例中添加步骤](../img/api/在场景用例中添加步骤2.png)
    
    ![!在场景用例中添加步骤](../img/api/在场景用例中添加步骤3.png)
    
    1. 选中 `login_1` 请求步骤，点击添加步骤按钮，在该请求下添加两个 `提取参数` 子步骤。一个提取步骤名称为 `提取用户name`，采用`推荐 JSONPath 提取`方式，勾选名称为`name`的属性，JSONPath 表达式为 `$.data.name`，
    一个提取步骤名称为 `获取CSRF-TOKEN`，同样采用`推荐 JSONPath 提取`方式，勾选名称为`name`的属性，JSONPath 表达式为 `$.data.csrfToken`，
    
       ![!在场景用例中添加步骤](../img/api/在场景用例中添加步骤4.png)
    
       ![!在场景用例中添加步骤](../img/api/在场景用例中添加步骤5.png)

       ![!在场景用例中添加步骤](../img/api/在场景用例中添加步骤6.png)

       ![!在场景用例中添加步骤](../img/api/在场景用例中添加步骤7.png)
    
2. 再次添加一个 `接口列表导入` 步骤，选择 `getUserList` 接口。修改请求头里的CSRF-TOKEN参数，设置为`${csrfToken}`，修改该接口请求中的REST参数goPage为1，pageSize为10，设置修改该接口请求体中的 `name`参数值为 `${name}`，引用上一步请求中提取到的变量值。
  ![!在场景用例中添加步骤](../img/api/在场景用例中添加步骤8.png)


## 查看测试报告

### 执行场景用例

场景步骤添加完成后，点击场景步上方的的 `调试` 按钮，可在列表查看各个步骤执行状态，展开可查看接口执行的详细信息。
![!执行场景并查看结果](../img/api/调试场景.png)

### 生成报告
点击场景步上方的的 `调试` 按钮旁边的`V`，选择 `生成报告`，生产报告和查看生成场景报告详细信息。
![!保存测试报告](../img/api/生成报告1.png)

![!保存测试报告](../img/api/生成报告2.png)

![!保存测试报告](../img/api/生成报告3.png)

到报告列表查看报告详情和导出报告
![!保存测试报告](../img/api/生成报告4.png)
